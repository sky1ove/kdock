# Protenix-dock


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

TODO: get more conformers in sdf file, and test for virtual screening

## Install instruction

- [tutorial](https://zhuanlan.zhihu.com/p/1896530309580838652), install
  protenix-dock accordingly
- [official github](https://github.com/bytedance/Protenix-Dock)

## After install

> Test whether the notebook can import it successfully

if vscode:

``` bash
export LD_LIBRARY_PATH=${CONDA_PREFIX}/lib:$LD_LIBRARY_PATH
```

If jupyterlab on a cloud, need to set secrete:

``` python
import os
conda_lib_path = os.path.join(os.environ["CONDA_PREFIX"], "lib")
current_path = os.environ.get("LD_LIBRARY_PATH", "")
print(conda_lib_path,current_path)

# if in cloud, set the secrete according to below
os.environ['LD_LIBRARY_PATH'] ="/home/zeus/miniconda3/envs/cloudspace/lib:/opt/jupyter/envs/main/lib"
print(os.environ['LD_LIBRARY_PATH'])
```

## Setup

## One-time protenix-dock

``` python
get_rec_lig('7OFF','VCB','protenix_test')
```

    7OFF.pdb is detected!

    ('/teamspace/studios/this_studio/kdock/nbs/protenix_test/7OFF_receptor.pdb',
     '/teamspace/studios/this_studio/kdock/nbs/protenix_test/7OFF_lig.sdf')

``` python
box = get_box('protenix_test/7OFF_lig.sdf',tolist=True)
box
```

    [38.848, -26.77, 10.419, 14.652, 8.942, 12.509]

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/px/dock.py#L33"
target="_blank" style="float:right; font-size:smaller">source</a>

### capture_output

>  capture_output (log_path)

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/px/dock.py#L60"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_protenix_dock

>  get_protenix_dock (receptor_pdb, ligand_sdf, box:list, out_dir='.',
>                         num_walker=20, mc_prune_energy_threshold=500,
>                         include_affinity=True, **kwargs)

*Use protenix-dock to dock ligand sdf to receptor pdb using
protenix-dock*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>receptor_pdb</td>
<td></td>
<td></td>
<td>pdb path</td>
</tr>
<tr>
<td>ligand_sdf</td>
<td></td>
<td></td>
<td>sdf path</td>
</tr>
<tr>
<td>box</td>
<td>list</td>
<td></td>
<td>center xyz + size xyz</td>
</tr>
<tr>
<td>out_dir</td>
<td>str</td>
<td>.</td>
<td>output directory</td>
</tr>
<tr>
<td>num_walker</td>
<td>int</td>
<td>20</td>
<td>number of Monte Carlo threads, the more walkers the more space to
explore</td>
</tr>
<tr>
<td>mc_prune_energy_threshold</td>
<td>int</td>
<td>500</td>
<td>maximum allowed energy for a pose; if exceeds, skipped</td>
</tr>
<tr>
<td>include_affinity</td>
<td>bool</td>
<td>True</td>
<td>include bscore</td>
</tr>
<tr>
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

The function will output `-prepared-ligand/receptor.json` in the same
directory as the receptor & ligand files

And output a `out.json` and log in the `out_dir`

``` python
# %%time
# get_protenix_dock('protenix_test/7OFF_receptor.pdb',
#                   'protenix_test/7OFF_lig.sdf',
#                   box,
#                   out_dir='protenix_test/dock_result',
#                   num_walker=20
#                  )
```

## Protenix-vina

> Vina function in protenix-dock repository

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/px/dock.py#L85"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_protenix_vina_dock

>  get_protenix_vina_dock (receptor_pdb, ligand_sdf, box:list, out_dir='.',
>                              **kwargs)

*Dock ligand sdf to receptor pdb using protenix-dock*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>receptor_pdb</td>
<td></td>
<td></td>
<td>pdb path</td>
</tr>
<tr>
<td>ligand_sdf</td>
<td></td>
<td></td>
<td>sdf path</td>
</tr>
<tr>
<td>box</td>
<td>list</td>
<td></td>
<td>center xyz + size xyz</td>
</tr>
<tr>
<td>out_dir</td>
<td>str</td>
<td>.</td>
<td>output directory</td>
</tr>
<tr>
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

``` python
# %%time
# get_protenix_vina_dock('protenix_test/7OFF_receptor.pdb',
#                   'protenix_test/7OFF_lig.sdf',
#                   box,
#                   out_dir='protenix_test/vina_result',
#                  )
```

## Output to sdf

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/px/dock.py#L104"
target="_blank" style="float:right; font-size:smaller">source</a>

### json2sdf

>  json2sdf (json_path, sdf_path=None)

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>json_path</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>sdf_path</td>
<td>NoneType</td>
<td>None</td>
<td>.sdf to be saved</td>
</tr>
</tbody>
</table>

``` python
list(Path('protenix_test/dock_result').glob('*_out.json'))
```

    [PosixPath('protenix_test/dock_result/7OFF_lig-prepared-ligand-0_out.json')]

``` python
# json2sdf('protenix_test/dock_result/7OFF_lig-prepared-ligand-0_out.json',
#          sdf_path='protenix_test/predicted.sdf')
```

## End
