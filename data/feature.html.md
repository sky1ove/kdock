# Feature


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Setup

## Rdkit feature

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L27"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_rdkit

>  get_rdkit (SMILES:str)

*Extract chemical features from SMILES Reference:
https://greglandrum.github.io/rdkit-blog/posts/2022-12-23-descriptor-tutorial.html*

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L36"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_rdkit_3d

>  get_rdkit_3d (SMILES:str)

*Extract 3d features from SMILES*

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L45"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_rdkit_all

>  get_rdkit_all (SMILES:str)

*Extract chemical features and 3d features from SMILES*

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L52"
target="_blank" style="float:right; font-size:smaller">source</a>

### remove_hi_corr

>  remove_hi_corr (df:pandas.core.frame.DataFrame, thr=0.99)

*Remove highly correlated features in a dataframe given a pearson
threshold*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>df</td>
<td>DataFrame</td>
<td></td>
<td></td>
</tr>
<tr>
<td>thr</td>
<td>float</td>
<td>0.99</td>
<td>threshold</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L62"
target="_blank" style="float:right; font-size:smaller">source</a>

### preprocess

>  preprocess (df:pandas.core.frame.DataFrame, thr=0.99)

*Remove features with no variance, and highly correlated features based
on threshold.*

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L87"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_rdkit_df

>  get_rdkit_df (df:pandas.core.frame.DataFrame, include_3d=False,
>                    col='SMILES', postprocess=False, chunksize=128)

*Extract rdkit features (optionally in parallel with 3D) from SMILES in
a df*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>df</td>
<td>DataFrame</td>
<td></td>
<td></td>
</tr>
<tr>
<td>include_3d</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr>
<td>col</td>
<td>str</td>
<td>SMILES</td>
<td></td>
</tr>
<tr>
<td>postprocess</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr>
<td>chunksize</td>
<td>int</td>
<td>128</td>
<td>for parallel process_map</td>
</tr>
</tbody>
</table>

``` python
# df=Data.collins.get_antibiotics_2k().head(300)
# df.head()
```

``` python
# %%time
# feat_raw=get_rdkit_df(df)
# feat_raw
```

``` python
# feat = get_rdkit_df(df,postprocess=True)
# feat
```

## Morgan fingerprints (ECFP)

Reference: - [kaggle notebook,
scikit-fingerprints](https://www.kaggle.com/code/michaszafarczyk/molecular-fingerprints-using-scikit-fingerprints) -
[scikit-fingerprints
github](https://github.com/scikit-fingerprints/scikit-fingerprints) -
[kaggle notebook, fingerprint tips and
tricks](https://www.kaggle.com/code/towardsentropy/fingerprint-tips-and-tricks)

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L108"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_fp

>  get_fp (SMILES, name='ecfp', ELEMENTS_PER_WORKER=1000000)

*Super fast method to get molecule fingerprints using
scikit-fingerprints*

``` python
# %%time
# fp = get_fp(df.SMILES, name='ecfp')
# fp
```

## Use np.packbits to save space

> Save space when dealing with super big dataset

Packbits will transform binary to decimals, if it is \[1, 0, 1, 1, 0, 0,
0, 0, 1, 1\], then it will take 8 bits in the sequence, \[10110000\] and
\[11000000\], for the latter, if not enough for 8 bits length, it will
add 0.

To transform binary to decimals, take \[10110000\] for example,
calculate through 1*2^7 + 0*2^6 + 1*2^5 + 1*2^4 + 0*2^3 + 0*2^2 +
0*2^1 + 0*2^0=176

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L133"
target="_blank" style="float:right; font-size:smaller">source</a>

### compress_fp

>  compress_fp (array)

*Compress binary finterprints using np.packbits*

``` python
# compress_fp(fp)
```

## Tanimoto

Reference:
https://www.kaggle.com/code/towardsentropy/fingerprint-tips-and-tricks/notebook

Slow version:

Method 1

``` python
from scipy.spatial import distance
```

``` python
# %%time
# tanimotos_scipy = 1-distance.cdist(fp, fp, metric='jaccard')
# # 30.4s
```

A little faster with parallel

``` python
from sklearn.metrics import pairwise_distances
```

``` python
# %%time
# tanimotos_sklearn = 1 - pairwise_distances(fp, metric='jaccard', n_jobs=-1)
# # 13.1s
```

Method 2

``` python
from rdkit.Chem import DataStructs
```

``` python
# %%time
# tanimotos_rdkit = np.array([DataStructs.BulkTanimotoSimilarity(i, fp) for i in fp])
```

Method 3

``` python
def tanimoto_bitwise(fps_np):
    intersection = (fps_np[:,None] & fps_np[None]).sum(-1)
    union = (fps_np[:,None] | fps_np[None]).sum(-1)
    return intersection / union
```

``` python
# tanimoto_bitwise(fp)
```

### Numba tanimoto

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L139"
target="_blank" style="float:right; font-size:smaller">source</a>

### tanimoto_numba

>  tanimoto_numba (fps)

*Get a NxN matrix of tanimoto similarity among N compounds.*

``` python
# %%time
# tanimoto_numba(fp)
```

## Group same compounds

> Utilize hash sha256 to encode morgan fp and find same molecule

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L154"
target="_blank" style="float:right; font-size:smaller">source</a>

### hash_fp

>  hash_fp (fp_row)

*Hash a binary fingerprint row using SHA256*

``` python
# hash_fp(fp[0])
```

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L159"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_same_mol_group

>  get_same_mol_group (df, smi_col='SMILES')

*Assign a group number to the same compounds by utilizing hash sha256 to
encode morgan fp and find same molecule.*

``` python
# %%time
# df2 = get_same_mol_group(df)
# df2.group.value_counts()
```

## Dimensionality reduction

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/kdock/blob/main/kdock/data/feature.py#L184"
target="_blank" style="float:right; font-size:smaller">source</a>

### reduce_feature

>  reduce_feature (data, method='pca', complexity=20, n=2, seed:int=123,
>                      **kwargs)

*Reduce the dimensionality given a dataframe of values*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td></td>
<td></td>
<td>df or numpy array</td>
</tr>
<tr>
<td>method</td>
<td>str</td>
<td>pca</td>
<td>dimensionality reduction method, accept both capital and lower
case</td>
</tr>
<tr>
<td>complexity</td>
<td>int</td>
<td>20</td>
<td>None for PCA; perfplexity for TSNE, recommend: 30; n_neigbors for
UMAP, recommend: 15</td>
</tr>
<tr>
<td>n</td>
<td>int</td>
<td>2</td>
<td>n_components</td>
</tr>
<tr>
<td>seed</td>
<td>int</td>
<td>123</td>
<td>seed for random_state</td>
</tr>
<tr>
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

``` python
# pca = reduce_feature(fp,'pca',n=10)
# pca
```

## End

## Old
