# Gnina rescore with docked ligand


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Setup

``` python
from kdock.data.core import Data
from kdock.gnina.dock import *
from kdock.gnina.rescore import *
import pandas as pd, numpy as np
```

``` python
# setup_gnina_local('v1.1') # <= v1.1 allows cpu environment
```

    Reading package lists...
    Building dependency tree...
    Reading state information...
    openbabel is already the newest version (3.0.0+dfsg-3ubuntu3).
    0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
    Downloading v1.1 gnina
    Finish setup!

``` python
# setup_gnina_docker()
```

    Pulling GNINA Docker image: gnina/gnina
    GNINA Docker image is ready.

## Rescore

Get folder that contains the AF3 .cif files

### local ./gnina

``` python
df = get_gnina_rescore_folder('~/mirati_structure',
                              rec_chain_id='A',
                              lig_chain_id='L',
                             )
```

      0%|          | 0/660 [00:00<?, ?it/s]

    CPU times: user 1.19 s, sys: 257 ms, total: 1.44 s
    Wall time: 21min 55s

if vinardo score only:

``` python
df = get_gnina_rescore_folder('~/mirati_structure',
                              rec_chain_id='A',
                              lig_chain_id='L',
                              CNN_affinity=False,
                              vinardo=True,
                             )
```

### Docker gnina (latest)

``` python
df = get_gnina_rescore_folder('~/mirati_structure',
                              rec_chain_id='A',
                              lig_chain_id='L',
                              is_local=False)
```

## Merge with target

``` python
df.ID = df.ID.str[:-15]
```

``` python
target = Data.get_mirati_g12d()
```

``` python
target.ID=target.ID.str.lower()
```

``` python
target['log_Kd'] = np.log(target['Kd'] + 1e-5)
target['log_IC50'] = np.log(target['IC50'] + 1e-5)
target['log_erk_IC50'] = np.log(target['erk_IC50'] + 1e-5)
```

``` python
out =target.merge(df)
```

``` python
out.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SMILES</th>
<th data-quarto-table-cell-role="th">Kd</th>
<th data-quarto-table-cell-role="th">IC50</th>
<th data-quarto-table-cell-role="th">erk_IC50</th>
<th data-quarto-table-cell-role="th">log_Kd</th>
<th data-quarto-table-cell-role="th">log_IC50</th>
<th data-quarto-table-cell-role="th">log_erk_IC50</th>
<th data-quarto-table-cell-role="th">binding_energy</th>
<th data-quarto-table-cell-role="th">uncertainty</th>
<th data-quarto-table-cell-role="th">RMSD</th>
<th data-quarto-table-cell-role="th">CNNscore</th>
<th data-quarto-table-cell-role="th">CNNaffinity</th>
<th data-quarto-table-cell-role="th">CNNvariance</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>us_1</td>
<td>CN1CCC[C@H]1COc1nc(N2CC3CCC(C2)N3)c2cnc(cc2n1)...</td>
<td>97.7</td>
<td>124.7</td>
<td>3159.1</td>
<td>4.581902</td>
<td>4.825911</td>
<td>8.058042</td>
<td>-13.02696</td>
<td>-0.30852</td>
<td>0.88857</td>
<td>0.67440</td>
<td>7.76933</td>
<td>0.23841</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>us_4</td>
<td>Oc1cc(-c2ncc3c(nc(OCCc4ccccn4)nc3c2F)N2CC3CCC(...</td>
<td>155.7</td>
<td>496.2</td>
<td>8530.0</td>
<td>5.047931</td>
<td>6.206979</td>
<td>9.051345</td>
<td>-11.44830</td>
<td>-0.70801</td>
<td>1.01023</td>
<td>0.67062</td>
<td>7.98086</td>
<td>0.29582</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2</td>
<td>us_5</td>
<td>Cn1nccc1COc1nc(N2CC3CCC(C2)N3)c2cnc(c(F)c2n1)-...</td>
<td>294.8</td>
<td>722.9</td>
<td>8193.8</td>
<td>5.686297</td>
<td>6.583271</td>
<td>9.011133</td>
<td>-7.58041</td>
<td>-1.00321</td>
<td>0.91650</td>
<td>0.48476</td>
<td>7.27615</td>
<td>0.59758</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">3</td>
<td>us_6</td>
<td>Cc1cccnc1CCOc1nc(N2CC3CCC(C2)N3)c2cnc(c(F)c2n1...</td>
<td>442.2</td>
<td>434.1</td>
<td>11518.2</td>
<td>6.091762</td>
<td>6.073275</td>
<td>9.351684</td>
<td>-7.00049</td>
<td>-1.53471</td>
<td>4.55312</td>
<td>0.54943</td>
<td>6.14055</td>
<td>0.24137</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">4</td>
<td>us_7</td>
<td>Oc1cc(-c2ncc3c(nc(OCCc4ncccn4)nc3c2F)N2CC3CCC(...</td>
<td>463.5</td>
<td>1867.3</td>
<td>NaN</td>
<td>6.138806</td>
<td>7.532249</td>
<td>NaN</td>
<td>-13.12053</td>
<td>-0.93447</td>
<td>0.28536</td>
<td>0.71432</td>
<td>7.42845</td>
<td>0.04068</td>
</tr>
</tbody>
</table>

</div>

``` python
out.to_csv('mirati_gnina_v1_1.csv',index=False)
```

## Merge with AF score

``` python
df=pd.read_csv('mirati_gnina_rescore_v1_3.csv')
```

``` python
af = pd.read_csv('AF3_mirati_660.csv')
```

``` python
cols = ['ID','chain_pair_pae_min_0_1',
       'chain_pair_pae_min_1_0', 'chain_pair_pae_min_1_1', 'chain_ptm_0',
       'chain_ptm_1', 'fraction_disordered', 'iptm', 'ptm', 'ranking_score',
       'iptm_ptm_add', 'chain_pair_pae_min_add', 'iptm_rnk', 'ptm_rnk',
       'iptm_ptm_rnk_add', 'chain_pair_pae_min_add_rnk', 'iptm_pae_add_rnk']
```

``` python
af = af[cols]
```

``` python
df = df.merge(af)
```

``` python
df.to_csv('mirati_gnina_v1_3_af.csv',index=False)
```

## Correlation

``` python
out.corr(numeric_only=True)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Kd</th>
<th data-quarto-table-cell-role="th">IC50</th>
<th data-quarto-table-cell-role="th">erk_IC50</th>
<th data-quarto-table-cell-role="th">log_Kd</th>
<th data-quarto-table-cell-role="th">log_IC50</th>
<th data-quarto-table-cell-role="th">log_erk_IC50</th>
<th data-quarto-table-cell-role="th">binding_energy</th>
<th data-quarto-table-cell-role="th">uncertainty</th>
<th data-quarto-table-cell-role="th">RMSD</th>
<th data-quarto-table-cell-role="th">CNNscore</th>
<th data-quarto-table-cell-role="th">CNNaffinity</th>
<th data-quarto-table-cell-role="th">CNNvariance</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">Kd</td>
<td>1.000000</td>
<td>0.137290</td>
<td>-0.088274</td>
<td>0.567310</td>
<td>0.081667</td>
<td>-0.167722</td>
<td>0.057558</td>
<td>-0.017178</td>
<td>-0.025133</td>
<td>-0.048843</td>
<td>-0.050384</td>
<td>0.025814</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">IC50</td>
<td>0.137290</td>
<td>1.000000</td>
<td>0.379993</td>
<td>0.409676</td>
<td>0.405385</td>
<td>0.242495</td>
<td>0.053759</td>
<td>0.043837</td>
<td>0.004114</td>
<td>-0.018452</td>
<td>-0.084494</td>
<td>-0.056643</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">erk_IC50</td>
<td>-0.088274</td>
<td>0.379993</td>
<td>1.000000</td>
<td>0.340125</td>
<td>0.712639</td>
<td>0.734366</td>
<td>0.021087</td>
<td>0.178889</td>
<td>-0.048670</td>
<td>0.003114</td>
<td>-0.090038</td>
<td>-0.111960</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">log_Kd</td>
<td>0.567310</td>
<td>0.409676</td>
<td>0.340125</td>
<td>1.000000</td>
<td>0.685839</td>
<td>0.489439</td>
<td>0.248571</td>
<td>-0.040234</td>
<td>0.127425</td>
<td>-0.239114</td>
<td>-0.297084</td>
<td>-0.032168</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">log_IC50</td>
<td>0.081667</td>
<td>0.405385</td>
<td>0.712639</td>
<td>0.685839</td>
<td>1.000000</td>
<td>0.782773</td>
<td>0.122564</td>
<td>0.225565</td>
<td>0.034728</td>
<td>-0.102558</td>
<td>-0.241604</td>
<td>-0.134573</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">log_erk_IC50</td>
<td>-0.167722</td>
<td>0.242495</td>
<td>0.734366</td>
<td>0.489439</td>
<td>0.782773</td>
<td>1.000000</td>
<td>0.104046</td>
<td>0.180925</td>
<td>-0.018172</td>
<td>-0.056561</td>
<td>-0.203590</td>
<td>-0.102189</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">binding_energy</td>
<td>0.057558</td>
<td>0.053759</td>
<td>0.021087</td>
<td>0.248571</td>
<td>0.122564</td>
<td>0.104046</td>
<td>1.000000</td>
<td>-0.446761</td>
<td>0.585579</td>
<td>-0.605980</td>
<td>-0.719846</td>
<td>0.146693</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">uncertainty</td>
<td>-0.017178</td>
<td>0.043837</td>
<td>0.178889</td>
<td>-0.040234</td>
<td>0.225565</td>
<td>0.180925</td>
<td>-0.446761</td>
<td>1.000000</td>
<td>-0.340409</td>
<td>0.415752</td>
<td>0.292460</td>
<td>-0.295152</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">RMSD</td>
<td>-0.025133</td>
<td>0.004114</td>
<td>-0.048670</td>
<td>0.127425</td>
<td>0.034728</td>
<td>-0.018172</td>
<td>0.585579</td>
<td>-0.340409</td>
<td>1.000000</td>
<td>-0.502661</td>
<td>-0.567085</td>
<td>0.241297</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNscore</td>
<td>-0.048843</td>
<td>-0.018452</td>
<td>0.003114</td>
<td>-0.239114</td>
<td>-0.102558</td>
<td>-0.056561</td>
<td>-0.605980</td>
<td>0.415752</td>
<td>-0.502661</td>
<td>1.000000</td>
<td>0.804062</td>
<td>-0.475357</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNaffinity</td>
<td>-0.050384</td>
<td>-0.084494</td>
<td>-0.090038</td>
<td>-0.297084</td>
<td>-0.241604</td>
<td>-0.203590</td>
<td>-0.719846</td>
<td>0.292460</td>
<td>-0.567085</td>
<td>0.804062</td>
<td>1.000000</td>
<td>-0.334174</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNvariance</td>
<td>0.025814</td>
<td>-0.056643</td>
<td>-0.111960</td>
<td>-0.032168</td>
<td>-0.134573</td>
<td>-0.102189</td>
<td>0.146693</td>
<td>-0.295152</td>
<td>0.241297</td>
<td>-0.475357</td>
<td>-0.334174</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>

``` python
out.corr('spearman',numeric_only=True)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Kd</th>
<th data-quarto-table-cell-role="th">IC50</th>
<th data-quarto-table-cell-role="th">erk_IC50</th>
<th data-quarto-table-cell-role="th">log_Kd</th>
<th data-quarto-table-cell-role="th">log_IC50</th>
<th data-quarto-table-cell-role="th">log_erk_IC50</th>
<th data-quarto-table-cell-role="th">binding_energy</th>
<th data-quarto-table-cell-role="th">uncertainty</th>
<th data-quarto-table-cell-role="th">RMSD</th>
<th data-quarto-table-cell-role="th">CNNscore</th>
<th data-quarto-table-cell-role="th">CNNaffinity</th>
<th data-quarto-table-cell-role="th">CNNvariance</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">Kd</td>
<td>1.000000</td>
<td>0.770684</td>
<td>0.484753</td>
<td>1.000000</td>
<td>0.770684</td>
<td>0.484753</td>
<td>0.307612</td>
<td>-0.041270</td>
<td>0.197978</td>
<td>-0.271837</td>
<td>-0.377634</td>
<td>-0.075319</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">IC50</td>
<td>0.770684</td>
<td>1.000000</td>
<td>0.821105</td>
<td>0.770684</td>
<td>1.000000</td>
<td>0.821105</td>
<td>0.214448</td>
<td>0.201271</td>
<td>0.024432</td>
<td>-0.102062</td>
<td>-0.317811</td>
<td>-0.171460</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">erk_IC50</td>
<td>0.484753</td>
<td>0.821105</td>
<td>1.000000</td>
<td>0.484753</td>
<td>0.821105</td>
<td>1.000000</td>
<td>0.148804</td>
<td>0.197881</td>
<td>-0.012566</td>
<td>-0.031280</td>
<td>-0.228966</td>
<td>-0.100639</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">log_Kd</td>
<td>1.000000</td>
<td>0.770684</td>
<td>0.484753</td>
<td>1.000000</td>
<td>0.770684</td>
<td>0.484753</td>
<td>0.307612</td>
<td>-0.041270</td>
<td>0.197978</td>
<td>-0.271837</td>
<td>-0.377634</td>
<td>-0.075319</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">log_IC50</td>
<td>0.770684</td>
<td>1.000000</td>
<td>0.821105</td>
<td>0.770684</td>
<td>1.000000</td>
<td>0.821105</td>
<td>0.214448</td>
<td>0.201271</td>
<td>0.024432</td>
<td>-0.102062</td>
<td>-0.317811</td>
<td>-0.171460</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">log_erk_IC50</td>
<td>0.484753</td>
<td>0.821105</td>
<td>1.000000</td>
<td>0.484753</td>
<td>0.821105</td>
<td>1.000000</td>
<td>0.148804</td>
<td>0.197881</td>
<td>-0.012566</td>
<td>-0.031280</td>
<td>-0.228966</td>
<td>-0.100639</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">binding_energy</td>
<td>0.307612</td>
<td>0.214448</td>
<td>0.148804</td>
<td>0.307612</td>
<td>0.214448</td>
<td>0.148804</td>
<td>1.000000</td>
<td>-0.318202</td>
<td>0.643279</td>
<td>-0.596055</td>
<td>-0.657687</td>
<td>0.110284</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">uncertainty</td>
<td>-0.041270</td>
<td>0.201271</td>
<td>0.197881</td>
<td>-0.041270</td>
<td>0.201271</td>
<td>0.197881</td>
<td>-0.318202</td>
<td>1.000000</td>
<td>-0.285817</td>
<td>0.383521</td>
<td>0.103260</td>
<td>-0.278986</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">RMSD</td>
<td>0.197978</td>
<td>0.024432</td>
<td>-0.012566</td>
<td>0.197978</td>
<td>0.024432</td>
<td>-0.012566</td>
<td>0.643279</td>
<td>-0.285817</td>
<td>1.000000</td>
<td>-0.608563</td>
<td>-0.558381</td>
<td>0.233253</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNscore</td>
<td>-0.271837</td>
<td>-0.102062</td>
<td>-0.031280</td>
<td>-0.271837</td>
<td>-0.102062</td>
<td>-0.031280</td>
<td>-0.596055</td>
<td>0.383521</td>
<td>-0.608563</td>
<td>1.000000</td>
<td>0.765298</td>
<td>-0.483761</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNaffinity</td>
<td>-0.377634</td>
<td>-0.317811</td>
<td>-0.228966</td>
<td>-0.377634</td>
<td>-0.317811</td>
<td>-0.228966</td>
<td>-0.657687</td>
<td>0.103260</td>
<td>-0.558381</td>
<td>0.765298</td>
<td>1.000000</td>
<td>-0.251215</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNvariance</td>
<td>-0.075319</td>
<td>-0.171460</td>
<td>-0.100639</td>
<td>-0.075319</td>
<td>-0.171460</td>
<td>-0.100639</td>
<td>0.110284</td>
<td>-0.278986</td>
<td>0.233253</td>
<td>-0.483761</td>
<td>-0.251215</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>

``` python
out.corr('spearman',numeric_only=True)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Kd</th>
<th data-quarto-table-cell-role="th">IC50</th>
<th data-quarto-table-cell-role="th">erk_IC50</th>
<th data-quarto-table-cell-role="th">binding_energy</th>
<th data-quarto-table-cell-role="th">uncertainty</th>
<th data-quarto-table-cell-role="th">RMSD</th>
<th data-quarto-table-cell-role="th">CNNscore</th>
<th data-quarto-table-cell-role="th">CNNaffinity</th>
<th data-quarto-table-cell-role="th">CNNvariance</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">Kd</td>
<td>1.000000</td>
<td>0.770684</td>
<td>0.484753</td>
<td>0.307595</td>
<td>-0.041586</td>
<td>0.198397</td>
<td>-0.318074</td>
<td>-0.343751</td>
<td>0.173958</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">IC50</td>
<td>0.770684</td>
<td>1.000000</td>
<td>0.821105</td>
<td>0.214860</td>
<td>0.201848</td>
<td>0.019858</td>
<td>-0.164505</td>
<td>-0.355147</td>
<td>0.205119</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">erk_IC50</td>
<td>0.484753</td>
<td>0.821105</td>
<td>1.000000</td>
<td>0.150561</td>
<td>0.201548</td>
<td>-0.023826</td>
<td>-0.118687</td>
<td>-0.287123</td>
<td>0.202999</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">binding_energy</td>
<td>0.307595</td>
<td>0.214860</td>
<td>0.150561</td>
<td>1.000000</td>
<td>-0.317127</td>
<td>0.642633</td>
<td>-0.723730</td>
<td>-0.723106</td>
<td>0.457403</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">uncertainty</td>
<td>-0.041586</td>
<td>0.201848</td>
<td>0.201548</td>
<td>-0.317127</td>
<td>1.000000</td>
<td>-0.290202</td>
<td>0.329470</td>
<td>0.111949</td>
<td>-0.021203</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">RMSD</td>
<td>0.198397</td>
<td>0.019858</td>
<td>-0.023826</td>
<td>0.642633</td>
<td>-0.290202</td>
<td>1.000000</td>
<td>-0.664650</td>
<td>-0.442909</td>
<td>0.441766</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNscore</td>
<td>-0.318074</td>
<td>-0.164505</td>
<td>-0.118687</td>
<td>-0.723730</td>
<td>0.329470</td>
<td>-0.664650</td>
<td>1.000000</td>
<td>0.635484</td>
<td>-0.412043</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNaffinity</td>
<td>-0.343751</td>
<td>-0.355147</td>
<td>-0.287123</td>
<td>-0.723106</td>
<td>0.111949</td>
<td>-0.442909</td>
<td>0.635484</td>
<td>1.000000</td>
<td>-0.269412</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">CNNvariance</td>
<td>0.173958</td>
<td>0.205119</td>
<td>0.202999</td>
<td>0.457403</td>
<td>-0.021203</td>
<td>0.441766</td>
<td>-0.412043</td>
<td>-0.269412</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
