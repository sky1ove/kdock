# Protenix: virtual screening


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Install

``` bash
git clone https://github.com/bytedance/Protenix.git
cd Protenix
pip install .
```

## Setup

``` python
from kdock.data.core import Data
from kdock.px.core import *
```

## Protein sequence

``` python
kras = Data.get_kras_seq()
kras
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">WT_sequence</th>
<th data-quarto-table-cell-role="th">g12d_seq</th>
<th data-quarto-table-cell-role="th">g12c_seq</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>kras_human</td>
<td>MTEYKLVVVGAGGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVI...</td>
<td>MTEYKLVVVGADGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVI...</td>
<td>MTEYKLVVVGACGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVI...</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>kras_human_isoform2b</td>
<td>MTEYKLVVVGAGGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVI...</td>
<td>MTEYKLVVVGADGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVI...</td>
<td>MTEYKLVVVGACGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVI...</td>
</tr>
</tbody>
</table>

</div>

``` python
g12d = kras.iloc[0]['g12d_seq']
```

``` python
g12d
```

    'MTEYKLVVVGADGVGKSALTIQLIQNHFVDEYDPTIEDSYRKQVVIDGETCLLDILDTAGQEEYSAMRDQYMRTGEGFLCVFAINNTKSFEDIHHYREQIKRVKDSEDVPMVLVGNKCDLPSRTVDTKQAQDLARSYGIPFIETSAKTRQRVEDAFYTLVREIRQYRLKKISKEEKTPGCVKIKKCIIM'

## Get MSA on server

Submitted on protenix-server to get msa/pairing & unpairing a3m files.

Upload and make a folder that contains the two files, use it as
`msa_dir`

## SMILES

``` python
df = Data.get_mirati_g12d()
```

``` python
df.ID.duplicated(keep=False).sum()
```

    0

``` python
df.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">SMILES</th>
<th data-quarto-table-cell-role="th">Kd</th>
<th data-quarto-table-cell-role="th">IC50</th>
<th data-quarto-table-cell-role="th">erk_IC50</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>US_1</td>
<td>CN1CCC[C@H]1COc1nc(N2CC3CCC(C2)N3)c2cnc(cc2n1)...</td>
<td>97.7</td>
<td>124.7</td>
<td>3159.1</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">1</td>
<td>US_4</td>
<td>Oc1cc(-c2ncc3c(nc(OCCc4ccccn4)nc3c2F)N2CC3CCC(...</td>
<td>155.7</td>
<td>496.2</td>
<td>8530.0</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2</td>
<td>US_5</td>
<td>Cn1nccc1COc1nc(N2CC3CCC(C2)N3)c2cnc(c(F)c2n1)-...</td>
<td>294.8</td>
<td>722.9</td>
<td>8193.8</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">3</td>
<td>US_6</td>
<td>Cc1cccnc1CCOc1nc(N2CC3CCC(C2)N3)c2cnc(c(F)c2n1...</td>
<td>442.2</td>
<td>434.1</td>
<td>11518.2</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">4</td>
<td>US_7</td>
<td>Oc1cc(-c2ncc3c(nc(OCCc4ncccn4)nc3c2F)N2CC3CCC(...</td>
<td>463.5</td>
<td>1867.3</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>

## Test a positive control

> MRTX

``` python
get_single_protein_ligand_json?
```

    Signature:
    get_single_protein_ligand_json(
        job_name,
        protein_seq,
        msa_dir,
        SMILES=None,
        CCD=None,
        json_path=None,
    )
    Docstring: Generate and optionally save a JSON config for one protein-ligand job.
    File:      /tmp/ipykernel_1724/1197518213.py
    Type:      function

``` python
_ = get_single_protein_ligand_json('kras_g12d_mrtx',
                                 g12d,
                                 msa_dir='kras_g12d_msa',
                                 SMILES="C#CC1=C(C=CC2=CC(=CC(=C21)C3=NC=C4C(=C3F)N=C(N=C4N5CC6CCC(C5)N6)OC[C@@]78CCCN7C[C@@H](C8)F)O)F",
                                 json_path='g12d_mrtx.json'
                                )
```

    JSON saved to g12d_mrtx.json

## Protenix command

``` bash
protenix predict --input g12d_mrtx.json --out_dir  ./output --seeds 101
```

## Run with other SMILES

``` python
get_virtual_screening_json?
```

    Signature:
    get_virtual_screening_json(
        df,
        protein_seq,
        msa_dir,
        id_col,
        smi_col=None,
        ccd_col=None,
        save_json=None,
    )
    Docstring: Get json file of single protein against multiple SMILES in a dataframe.
    File:      /tmp/ipykernel_1724/3782683879.py
    Type:      function

``` python
_ = get_virtual_screening_json(df,
                               g12d,
                               'kras_g12d_msa',
                               id_col='ID',
                               smi_col='SMILES',
                               save_json='kras_g12d_input.json')
```

    JSON saved to kras_g12d_input.json

``` bash
protenix predict --input kras_g12d_input.json --out_dir  ./output --seeds 101
```
